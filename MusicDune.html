<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adventures in Mali - Puzzle Round</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            background: #e9e9e9; !important;
            font-family: 'Press Start 2P';
            text-align: center;
            color: black;
            font-size: larger;
         
        }

        .card {
            width: 400px;
            height: 600px;
            background-color: #f2c94c;
            display: inline-block;
            margin: 10px;
            border: 4px solid black;
            text-align: center;
            position: relative;
        }

        

        .instrument-img {
            width: 80%;
            height: 80%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .left {
            float: left;
            margin-left: 10%;
            border: 4px solid black;
           
        }

        .middle {
            display: inline-block;
            margin: 0 auto;
            border: 4px solid black;
            
        }

        .right {
            float: right;
            margin-right: 10%;
            border: 4px solid black;
           
            
        }

        .button-container {
            text-align: center;
            margin-top: 20px;
        }

        .button-container button {
            margin: 0 10px;
            padding: 10px 20px;
            font-size: 16px;
            background-color: #f2c94c;
            border: 4px solid black;
            font-family: 'Press Start 2P';
            font-size: 25px;
            text-align: center;
            margin-top: 250px; 
            transition: background-color 0.1s ease;
        }

        .button-container button:hover {
    /* Remove hover effect */
    background-color: #f2c94c;
}

    </style>
</head>
<body>
    <h1 id="gameDisplay">*Adventures In Mali*</h1>
    <div id="gameContainer"></div>
    <script>
        class MusicDune {
            constructor() {
                this.instruments = ["Mbira", "Djembe", "Bell", "Kundi", "Kora"];
                this.score = 0;
                this.currentRound = 0;
                this.musicSequence = [];
                this.positions = {};
                this.playerAnswers = [];
                this.inputIndex = 0;
            }

            generateSequence(round) {
    const manualDirections = [
        ["left", "middle", "right"],
        ["right", "middle", "left"],
        ["middle", "left", "right"],
        ["left", "right", "middle"]
    ];
    const directions = manualDirections[round];
    this.instruments = this.instruments.sort(() => 0.5 - Math.random());

    this.musicSequence = [];
    this.positions = {};

    for (let i = 0; i < 3 && i < this.instruments.length; ++i) {
        this.musicSequence.push(this.instruments[i]);
        this.positions[this.instruments[i]] = directions[i];
    }

    console.log("Positions:", this.positions); // Add this line to log the positions object
}

            async displaySequence() {
                const gameContainer = document.getElementById("gameContainer");
                gameContainer.innerHTML = ''; // Clear any existing content

                for (let i = 0; i < this.musicSequence.length; ++i) {
                    const instrument = this.musicSequence[i];
                    const position = this.positions[instrument];
                    const card = document.createElement("div");
                    card.className = `card ${position}`;
                    const img = document.createElement("img");
                    img.src = `${instrument}.png`; // Assuming images are named after the instruments
                    img.alt = instrument;
                    img.className = "instrument-img";
                    card.appendChild(img);

                    gameContainer.appendChild(card);

                    await new Promise(resolve => setTimeout(resolve, 1000));
                    card.remove(); // Remove the card after displaying for 1 second
                }
            }

            showButtons() {
    const buttonsContainer = document.createElement("div");
    buttonsContainer.className = "button-container";

    const directions = ["left", "middle", "right"]; // Always in the order: left, middle, right

    for (let i = 0; i < directions.length; ++i) {
        const button = document.createElement("button");
        button.textContent = directions[i];
        button.onclick = () => this.handleButtonClick(directions[i]);
        buttonsContainer.appendChild(button);
    }

    document.getElementById("gameContainer").appendChild(buttonsContainer);
}

            async playRound(round) {
                this.generateSequence(round);
                await this.displaySequence();
                this.showButtons(round);
            }

            async play() {
                await this.playRound(this.currentRound);
            }
            
            handleButtonClick(answer) {
    const button = event.target;
    const expectedSequences = [
        ["left", "middle", "right"],
        ["right", "middle", "left"],
        ["middle", "left", "right"],
        ["left", "right", "middle"]
    ];

    const isCorrect = answer === expectedSequences[this.currentRound][this.inputIndex];

    if (isCorrect) {
        this.score++; // Increment the score if the answer is correct
        button.style.backgroundColor = 'green';
    } else {
        button.style.backgroundColor = 'red';
    }

    setTimeout(() => {
        button.style.backgroundColor = ''; // Reset button color after a short delay
        if (this.inputIndex === this.musicSequence.length - 1) {
            if (this.currentRound < 3) {
                this.currentRound++;
                this.playRound(this.currentRound);
            } else {
                document.getElementById("gameContainer").innerHTML = `<h2>Final Score: ${this.score}</h2>`;
            }
            this.inputIndex = 0; // Reset input index
            this.playerAnswers = []; // Reset player answers
            // Re-enable buttons for the next round after a short delay
            setTimeout(() => {
                const buttons = document.querySelectorAll('.button-container button');
                buttons.forEach(btn => {
                    btn.disabled = false;
                });
            }, 1000);
        } else {
            this.inputIndex++;
        }
    }, 1000);
}


        }

        const musicDuneGame = new MusicDune();
        musicDuneGame.play();
    </script>
</body>
</html>
